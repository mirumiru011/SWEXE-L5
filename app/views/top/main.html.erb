<div style="background-color: #f0f0f0; padding: 10px; margin-bottom: 20px;">
  <% if logged_in? %> <%# ログインしている場合 %>
    <p>
      ログイン中のユーザー: <strong><%= current_user.uid %></strong>
      <% if current_user.profile.present? %>
        <%= link_to 'プロフィールを見る', profile_path(current_user.profile) %> |
        <%= link_to 'プロフィールを編集', edit_profile_path(current_user.profile) %>
      <% else %>
        <%= link_to 'プロフィールを作成', new_profile_path %>
      <% end %>
      | <%= link_to 'ログアウト', top_logout_path %>
    </p>

    <h2>新しいツイート</h2>
    <%= form_with model: Tweet.new, url: tweets_path, local: true do |f| %>
      <div>
        <%= f.text_area :message, placeholder: "いまどうしてる？", rows: 3 %>
      </div>
      <div>
        <%= f.submit "ツイートする" %>
      </div>
    <% end %>

  <% else %> <%# ログインしていない場合 %>
    <p>ログインしていません。</p>
    <p>
      <%= link_to 'ログインはこちら', top_login_form_path %> |
      <%= link_to '新規登録はこちら', new_user_path %>
    </p>
  <% end %>
</div>

<hr>

<h2>ツイート一覧</h2>
<% @tweets.each do |tweet| %>
  <p>
    <strong><%= tweet.user&.uid || '削除済みユーザー' %>:</strong>
    <%= tweet.message %>
    (いいね: <%= tweet.likes.count %>件)
    
    <% if logged_in? %> <%# ログイン時のみいいねボタンを表示 %>
      
      <%# モデルの liked? メソッドを使ってチェックし、リンクを一つにまとめる %>
      <% if tweet.liked?(current_user) %>
                <%= link_to 'いいね削除', tweet_likes_path(tweet), data: { turbo_method: :delete } %>
      <% else %>
                <%= link_to 'いいね', tweet_likes_path(tweet), data: { turbo_method: :post } %>
      <% end %>

    <% end %>

    <%# ツイート削除リンク %>
    <%= link_to '削除', tweet_path(tweet), data: { turbo_method: :delete, turbo_confirm: '本当にこのツイートを削除しますか？' }, style: 'color: red;' %>
  </p>
<% end %>